<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Getting Started | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/ class=pf-c-nav__link>Retail</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/getting-started/ class="pf-c-nav__link pf-m-current">Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/store/ class=pf-c-nav__link>Store Sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/application/ class=pf-c-nav__link>Application Demos</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/components/ class=pf-c-nav__link>Components</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/troubleshooting/ class=pf-c-nav__link>Troubleshooting</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/retail/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class="pf-c-page__main-section pf-m-fill"><div class=pf-u-display-flex><div class="pf-c-content min-height"><h1 id=deploying-the-retail-pattern>Deploying the Retail Pattern</h1><h2 id=prerequisites>Prerequisites</h2><ol><li><p>An OpenShift cluster (Go to <a href=https://console.redhat.com/openshift/create>the OpenShift console</a>). Cluster must have a dynamic StorageClass to provision PersistentVolumes. See also <a href=../../retail/cluster-sizing>sizing your cluster</a>.</p></li><li><p>(Optional) A second OpenShift cluster for a second store environment, &ldquo;raleigh&rdquo;.</p></li><li><p>A GitHub account</p></li><li><p>(Optional) A quay account that can update images; this is if you want to use the pipelines to customize the applications</p></li><li><p>(Optional) A quay account with the following repositories set as public, and which you can write to:</p><ul><li>quarkuscoffeeshop-barista</li><li>quarkuscoffeeshop-counter</li><li>quarkuscoffeeshop-customerloyalty</li><li>quarkuscoffeeshop-customermocker</li><li>quarkuscoffeeshop-inventory</li><li>quarkuscoffeeshop-kitchen</li><li>quarkuscoffeeshop-majestic-monolith</li><li>quarkuscoffeeshop-web</li></ul><p>These repos comprise the microservices that are in the demo. The public repos (quay.io/hybrid-cloud-patterns/*) contain pre-built images which will be downloaded and used by default; so the demo will run regardless of whether you choose to rebuild the apps or not. This mechanism is provided for transparency purposes (so you can reproduce the same results); or if you want to customize or change the apps themselves in some way.</p></li></ol><p>The use of this pattern depends on having at least one running Red Hat
OpenShift cluster. All of the apps will run on a single cluster; optionally you can use RHACM to apply the store apps to a second cluster.</p><p>If you do not have a running Red Hat OpenShift cluster you can start one on a
public or private cloud by using <a href=https://console.redhat.com/openshift/create>Red Hat&rsquo;s cloud
service</a>.</p><h2 id=prerequisite-tools>Prerequisite Tools</h2><p>Install the installation tooling dependencies. You will need:</p><p>{% include prerequisite-tools.md %}</p><h2 id=how-to-deploy>How to deploy</h2><ol><li><p>Fork the <a href=https://github.com/hybrid-cloud-patterns/retail>retail</a> repository on GitHub.</p></li><li><p>Clone the forked copy of the <code>retail</code> repo. Use branch `v1.0'.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git clone git@github.com:<span style=color:#f92672>{</span>your-username<span style=color:#f92672>}</span>/retail.git
</span></span><span style=display:flex><span>cd retail
</span></span><span style=display:flex><span>git checkout v1.0
</span></span></code></pre></div></li><li><p>You could create your own branch where you specific values will be pushed to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git checkout -b my-branch
</span></span></code></pre></div></li><li><p>A <code>values-secret.yaml</code> file is used to automate setup of secrets needed for:</p><ul><li>A container image registry (E.g. Quay)</li></ul><p>DO NOT COMMIT THIS FILE. You do not want to push personal credentials to GitHub.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cp values-secret.yaml.template ~/values-secret.yaml
</span></span><span style=display:flex><span>vi ~/values-secret.yaml
</span></span></code></pre></div></li><li><p>Customize the deployment for your cluster. Change the appropriate values in <code>values-global.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>vi values-global.yaml
</span></span><span style=display:flex><span>git add values-global.yaml
</span></span><span style=display:flex><span>git commit values-global.yaml
</span></span><span style=display:flex><span>git push origin my-branch
</span></span></code></pre></div></li></ol><p>In particular, the values that you need to change are under the <code>imageregistry</code> key, to use your own account and hostname. If you like, you can change the git settings (<code>account</code>, <code>email</code>, <code>hostname</code> to reflect your own account settings).</p><p>If you plan to customize the build of the applications themselves, there <code>revision</code> and <code>imageTag</code> settings for each of them. The defaults should suffice if you just want to see the apps running.</p><ol><li><p>You can deploy the pattern using the <a href=/infrastructure/using-validated-pattern-operator/>validated pattern operator</a>. If you do use the operator then skip to Validating the Environment below.</p></li><li><p>Preview the changes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./pattern.sh make show
</span></span></code></pre></div></li><li><p>Login to your cluster using oc login or exporting the KUBECONFIG</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc login
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>~/my-ocp-env/retail-hub
</span></span></code></pre></div></li><li><p>Apply the changes to your cluster</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./pattern-util.sh make install
</span></span></code></pre></div></li></ol><p>This will execute <code>make install</code> in the team&rsquo;s container, which will take a bit to load the first time. It contains ansible and other dependencies so that you do not need to install them on your workstation.</p><p>The default <code>install</code> target will:</p><ol><li>Install the pattern via the operator</li><li>Load the imageregistry secret into the vault</li><li>Start the application build pipelines</li></ol><p>If you chose not to put in your registry credential, <code>make install</code> cannot complete successfully because it waits for the secret to be populated before starting the pipelines.</p><p>If you do not want to run the (optional) components, another install target is provided:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>./common/scripts/pattern-util.sh make install-no-pipelines
</span></span></code></pre></div><p>This skips the vault setup and the pipeline builds, but still installs both Vault and the Pipelines operator, so if you want to run those in your installation later, you can run <code>make install</code> to enable them.</p><p>For more information on secrets management see <a href=/secrets>here</a>. For information on Hashicorp&rsquo;s Vault see <a href=/secrets/vault>here</a></p><h2 id=validating-the-environment>Validating the Environment</h2><p>Check the operators have been installed</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>UI -&gt; Installed Operators
</span></span></code></pre></div><p><a href=/images/retail/retail-v1-operators.png><img src=/images/retail/retail-v1-operators.png alt=retail-v1-operators></a></p><p>The OpenShift console menu should look like this. We will use it to validate that the pattern is working as expected:</p><p><a href=/images/retail/retail-v1-console-menu.png><img src=/images/retail/retail-v1-console-menu.png alt=retail-v1-console-menu></a></p><p>Check on the pipelines, if you chose to run them. They should all complete successfully:</p><p><a href=/images/retail/retail-v1-pipelines.png><img src=/images/retail/retail-v1-pipelines.png alt=retail-v1-pipelines></a></p><p>Ensure that the Hub ArgoCD instance shows all of its apps in Healthy and Synced status once all of the images have been built:</p><p><a href=/images/retail/retail-v1-argo-apps-p1.png><img src=/images/retail/retail-v1-argo-apps-p1.png alt=retail-v1-argo-apps-p1></a></p><p>We will go to the Landing Page, which will present the applications in the pattern:</p><p><a href=/images/retail/retail-v1-landing-page.png><img src=/images/retail/retail-v1-landing-page.png alt=retail-v1-landing-page></a></p><p>Clicking on the Store Web Page will place us in the Quarkus Coffeeshop Demo:</p><p><a href=/images/retail/retail-v1-store-page.png><img src=/images/retail/retail-v1-store-page.png alt=retail-v1-store-page></a></p><p>Clicking on the TEST Store Web Page will place us in a separate copy of the same demo.</p><p>Clicking on the respective Kafdrop links will go to a Kafdrop instance that allows inspection of each of the respective environments.</p><p><a href=/images/retail/retail-v1-kafdrop.png><img src=/images/retail/retail-v1-kafdrop.png alt=retail-v1-kafdrop></a></p><h2 id=next-steps>Next Steps</h2><p><a href=https://groups.google.com/g/hybrid-cloud-patterns>Help & Feedback</a>{: .btn .fs-5 .mb-4 .mb-md-0 .mr-2 }
<a href=https://github.com/hybrid-cloud-patterns/retail/issues>Report Bugs</a>{: .btn .btn-red .fs-5 .mb-4 .mb-md-0 .mr-2 }</p></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploying-the-retail-pattern>Deploying the Retail Pattern</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisites>Prerequisites</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisite-tools>Prerequisite Tools</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#how-to-deploy>How to deploy</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#validating-the-environment>Validating the Environment</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#next-steps>Next Steps</a></li></ul></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>