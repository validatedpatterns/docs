<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Getting Started | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/ class=pf-c-nav__link>Industrial Edge</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/getting-started/ class="pf-c-nav__link pf-m-current">Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/factory/ class=pf-c-nav__link>Factory Sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/application/ class=pf-c-nav__link>Application Demos</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/troubleshooting/ class=pf-c-nav__link>Troubleshooting</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class="pf-c-page__main-section pf-m-fill"><div class=pf-u-display-flex><div class="pf-c-content min-height"><h1 id=deploying-the-industrial-edge-pattern>Deploying the Industrial Edge Pattern</h1><h1 id=prerequisites>Prerequisites</h1><ol><li><p>An OpenShift cluster (Go to <a href=https://console.redhat.com/openshift/create>the OpenShift console</a>). Cluster must have a dynamic StorageClass to provision PersistentVolumes. See also <a href=../../industrial-edge/cluster-sizing>sizing your cluster</a>.</p></li><li><p>(Optional) A second OpenShift cluster for edge/factory</p></li><li><p>A GitHub account (and a token for it with repositories permissions, to read from and write to your forks)</p></li><li><p>A quay account with the following repositories set as public:</p><ul><li>http-ionic</li><li>httpd-ionic</li><li>iot-anomaly-detection</li><li>iot-consumer</li><li>iot-frontend</li><li>iot-software-sensor</li></ul></li></ol><p>The use of this blueprint depends on having at least one running Red Hat
OpenShift cluster. It is desirable to have a cluster for deploying the data
center assets and a separate cluster(s) for the factory assets.</p><p>If you do not have a running Red Hat OpenShift cluster you can start one on a
public or private cloud by using <a href=https://console.redhat.com/openshift/create>Red Hat&rsquo;s cloud
service</a>.</p><h2 id=prerequisite-tools>Prerequisite Tools</h2><p>Install the installation tooling dependencies. You will need:</p><p>{% include prerequisite-tools.md %}</p><h1 id=how-to-deploy>How to deploy</h1><ol><li><p>Clone the forked copy of the <code>industrial-edge</code> repo. Use branch <code>v2.1.1</code>.</p></li><li><p>Fork the <a href=https://github.com/hybrid-cloud-patterns/industrial-edge>industrial-edge</a> repository on GitHub. It is necessary to fork because your fork will be updated as part of the GitOps and DevOps processes.</p></li><li><p>Fork the <a href=https://github.com/hybrid-cloud-patterns/manuela-dev>manuela-dev</a> repository on GitHub. It is necessary to fork this repository because the GitOps framework will push tags to this repository that match the versions of software that it will deploy.</p></li><li><p>Clone the forked copy of the <code>industrial-edge</code> repository. Use branch <code>v2.1.1</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git clone git@github.com:<span style=color:#f92672>{</span>your-username<span style=color:#f92672>}</span>/industrial-edge.git
</span></span><span style=display:flex><span>cd industrial-edge
</span></span><span style=display:flex><span>git checkout v2.1.1
</span></span></code></pre></div></li><li><p>You could create your own branch where you specific values will be pushed to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git checkout -b my-branch
</span></span></code></pre></div></li><li><p>There are a number of common components used in validated patterns. These are kept in a common sub-directory. In order to use them we need to use the subtree feature of git.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>scripts/make_common_subtree.sh  
</span></span></code></pre></div></li><li><p>A <code>values-secret.yaml</code> file is used to automate setup of secrets needed for:</p><ul><li>A Git repository (E.g. Github, GitLab etc.)</li><li>A container image registry (E.g. Quay)</li><li>S3 storage (E.g. AWS)</li></ul><p>DO NOT COMMIT THIS FILE. You do not want to push personal credentials to GitHub.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cp values-secret.yaml.template ~/values-secret.yaml
</span></span><span style=display:flex><span>vi ~/values-secret.yaml
</span></span></code></pre></div></li><li><p>Customize the deployment for your cluster. Change the appropriate values in <code>values-global.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>vi values-global.yaml
</span></span><span style=display:flex><span>git add values-global.yaml
</span></span><span style=display:flex><span>git commit values-global.yaml
</span></span><span style=display:flex><span>git push origin my-branch
</span></span></code></pre></div></li><li><p>You can deploy the pattern using the <a href=/infrastructure/using-validated-pattern-operator/>validated pattern operator</a>. If you do use the operator then skip to Validating the Environment below.</p></li><li><p>Preview the changes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make show
</span></span></code></pre></div></li><li><p>Login to your cluster using oc login or exporting the KUBECONFIG</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc login
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>~/my-ocp-env/datacenter
</span></span></code></pre></div></li><li><p>Apply the changes to your cluster</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make install
</span></span></code></pre></div></li></ol><h1 id=validating-the-environment>Validating the Environment</h1><ol><li><p>Check the operators have been installed</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>UI -&gt; Installed Operators
</span></span></code></pre></div></li><li><p>Obtain the ArgoCD URLs and passwords</p><p>The URLs and login credentials for ArgoCD change depending on the pattern
name and the site names they control. Follow the instructions below to find
them, however you choose to deploy the pattern.</p><p>Display the fully qualified domain names, and matching login credentials, for
all ArgoCD instances:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ARGO_CMD<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>oc get secrets -A -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{range .items[*]}{&#34;oc get -n &#34;}{.metadata.namespace}{&#34; routes; oc -n &#34;}{.metadata.namespace}{&#34; extract secrets/&#34;}{.metadata.name}{&#34; --to=-\\n&#34;}{end}&#39;</span> | grep gitops-cluster<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>CMD<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $ARGO_CMD | sed <span style=color:#e6db74>&#39;s|- oc|-;oc|g&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>eval $CMD
</span></span></code></pre></div><p>The result should look something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NAME                       HOST/PORT                                                                                         PATH      SERVICES                   PORT    TERMINATION            WILDCARD
</span></span><span style=display:flex><span>datacenter-gitops-server   datacenter-gitops-server-industrial-edge-datacenter.apps.mycluster.mydomain.com          datacenter-gitops-server   https   passthrough/Redirect   None
</span></span><span style=display:flex><span># admin.password
</span></span><span style=display:flex><span>2F6kgITU3DsparWyC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                    HOST/PORT                                                                                   PATH   SERVICES                PORT    TERMINATION            WILDCARD
</span></span><span style=display:flex><span>factory-gitops-server   factory-gitops-server-industrial-edge-factory.apps.mycluster.mydomain.com          factory-gitops-server   https   passthrough/Redirect   None
</span></span><span style=display:flex><span># admin.password
</span></span><span style=display:flex><span>K4ctDIm3fH7ldhs8p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                      HOST/PORT                                                                              PATH   SERVICES                  PORT    TERMINATION            WILDCARD
</span></span><span style=display:flex><span>cluster                   cluster-openshift-gitops.apps.mycluster.mydomain.com                          cluster                   8080    reencrypt/Allow        None
</span></span><span style=display:flex><span>kam                       kam-openshift-gitops.apps.mycluster.mydomain.com                              kam                       8443    passthrough/None       None
</span></span><span style=display:flex><span>openshift-gitops-server   openshift-gitops-server-openshift-gitops.apps.mycluster.mydomain.com          openshift-gitops-server   https   passthrough/Redirect   None
</span></span><span style=display:flex><span># admin.password
</span></span><span style=display:flex><span>WNklRCD8EFg2zK034
</span></span></code></pre></div><p>The most important ArgoCD instance to examine at this point is <code>data-center-gitops-server</code>. This is where all the applications for the datacenter, including the test environment, can be tracked.</p></li><li><p>Apply the secrets from the <code>values-secret.yaml</code> to the secrets management Vault. This can be done through Vault&rsquo;s UI - manually without the file. The required secrets and scopes are:</p><ul><li><strong>secret/hub/git</strong> git <em>username</em> & <em>password</em> (GitHub token)</li><li><strong>secret/hub/imageregistry</strong> Quay or DockerHub <em>username</em> & <em>password</em></li><li><strong>secret/hub/aws</strong> - base64 encoded value (see below)</li></ul><p>For AWS S3 secret, create a file, say, s3-secrets, with two lines:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>s3.accessKey: &lt;accessKey&gt;
</span></span><span style=display:flex><span>s3.secretKey: &lt;secret key&gt;
</span></span></code></pre></div><p>Then encode this with base64 using</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat s3-secrets | base64 -w <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>Or you can set up the secrets using the command-line by running the following (Ansible) playbook.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>scripts/setup-secrets.yaml
</span></span></code></pre></div><p>Using the Vault UI check that the secrets have been setup.</p><p>For more information on secrets management see <a href=/secrets>here</a>. For information on Hashicorp&rsquo;s Vault see <a href=/secrets/vault>here</a></p></li><li><p>Check all applications are synchronised</p></li></ol><h2 id=next-steps>Next Steps</h2><p><a href=https://groups.google.com/g/hybrid-cloud-patterns>Help & Feedback</a>{: .btn .fs-5 .mb-4 .mb-md-0 .mr-2 }
<a href=https://github.com/hybrid-cloud-patterns/industrial-edge/issues>Report Bugs</a>{: .btn .btn-red .fs-5 .mb-4 .mb-md-0 .mr-2 }</p><p>Once the data center has been setup correctly and confirmed to be working, you can:</p><ol><li><p>Add a dedicated cluster to <a href=/industrial-edge/factory>deploy the factory pieces using ACM</a></p></li><li><p>Once the data center and the factory have been deployed you will want to check out and test the Industrial Edge 2.0 demo code. You can find that <a href=../application/>here</a></p><p>a. Making <a href=https://hybrid-cloud-patterns.io/industrial-edge/application/#configuration-changes-with-gitops>configuration changes</a> with GitOps
a. Making <a href=https://hybrid-cloud-patterns.io/industrial-edge/application/#application-changes-using-devops>application changes</a> using DevOps
a. Making <a href=https://hybrid-cloud-patterns.io/industrial-edge/application/#application-ai-model-changes-with-devops>AI/ML model changes</a> with DevOps</p></li></ol><h1 id=uninstalling>Uninstalling</h1><p><strong>Probably wont work</strong></p><ol><li><p>Turn off auto-sync</p><p><code>helm upgrade manuela . --values ~/values-secret.yaml --set global.options.syncPolicy=Manual</code></p></li><li><p>Remove the ArgoCD applications (except for manuela-datacenter)</p><p>a. Browse to ArgoCD
a. Go to Applications
a. Click delete
a. Type the application name to confirm
a. Chose &ldquo;Foreground&rdquo; as the propagation policy
a. Repeat</p></li><li><p>Wait until the deletions succeed</p><p><code>manuela-datacenter</code> should be the only remaining application</p></li><li><p>Complete the uninstall</p><p><code>helm delete manuela</code></p></li><li><p>Check all namespaces and operators have been removed</p></li></ol></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploying-the-industrial-edge-pattern>Deploying the Industrial Edge Pattern</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisites>Prerequisites</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisite-tools>Prerequisite Tools</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#how-to-deploy>How to deploy</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#validating-the-environment>Validating the Environment</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#next-steps>Next Steps</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#uninstalling>Uninstalling</a></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>