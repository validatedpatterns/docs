<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Using subdomain in your OpenShift route definitions | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class=pf-c-nav__item><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/blog/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Blog</span></a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class=pf-c-page__main-section><div class=pf-u-display-flex><div class="pf-c-content min-height"><h1>Using subdomain in your OpenShift route definitions</h1><div style="margin:10px 0">by Lester Claudio</div><div style="margin:10px 0">September 2, 2022</div><div style="margin:20px 0"><span class="pf-c-label pf-m-orange"><span class=pf-c-label__content>validated-pattern</span></span>
<span class="pf-c-label pf-m-orange"><span class=pf-c-label__content>openshift</span></span>
<span class="pf-c-label pf-m-orange"><span class=pf-c-label__content>route</span></span></div><hr class=pf-c-divider><h1 id=what-is-a-route-in-openshift>What Is a route in OpenShift?</h1><p>When creating Community or Validated Patterns using the Validated Patterns framework we often include application workloads, such as a UI, that will need to be accessed externally. A route allows developers to expose services through an HTTP(S) aware load balancing and proxy layer via a public DNS entry.</p><h1 id=how-is-the-kind-route-used-in-openshift>How is the kind: Route used in OpenShift?</h1><p>If your application is meant to be used externally then you will need to define a route so that users can access the service using the URL you specify in the route definition.</p><p>Here&rsquo;s a simple example of a <em>route</em> definition for a hello-openshift application:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>route.openshift.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Route</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>hello-openshift</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>hello-openshift-hello-openshift.&lt;Ingress_Domain&gt; </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>hello-openshift</span>
</span></span></code></pre></div><p>As you can see the spec describes the a <strong>host:</strong> or path to the route, the target port (8080), and the target, or <strong>to:</strong> that resolves into endpoints.</p><p>If we focus on the <strong>host:</strong> value you see that we need to provide the Ingress_Domain to the host. You might ask yourself: <em>why is this a problem?</em></p><p>If you manage just one cluster, and your application just runs on that cluster, you can just hard code the ingress domain and be on your merry way. But what happens when you are deploying this application to multiple clusters and their domains are different? Whoever is doing the Ops to deploy your application will have to change the Ingress_Domain to match the the cluster domain manually before deploying the application.</p><p>Let&rsquo;s go a step further and say you are using <em>GitOps</em>, and this definition lives in a <em>git</em> repository, what happens then? In our humble opinion it becomes a bit more complicated to make sure the ingress domain is set correctly.</p><h1 id=the-kind-route-spec-to-the-rescue>The kind: Route spec to the rescue</h1><p>The <em>route</em> specification for openshift can be found <a href=https://docs.openshift.com/container-platform/4.11/rest_api/network_apis/route-route-openshift-io-v1.html#spec>here</a>. If you look at the <em>.spec</em> section you can see the properties that can be used. The one that we will focus in the <em>subdomain</em> property. From our docs here&rsquo;s the definition of the <em>subdomain</em> property:</p><p><b>subdomain</b> is a DNS subdomain that is requested
within the ingress controller’s domain (as a subdomain).
If host is set this field is ignored. An ingress controller
may choose to ignore this suggested name, in which case the
controller will report the assigned name in the status.ingress
array or refuse to admit the route. If this value is set and
the server does not support this field host will be populated
automatically. Otherwise host is left empty. The field may
have multiple parts separated by a dot, but not all ingress
controllers may honor the request. This field may not be
changed after creation except by a user with the update
routes/custom-host permission.</p><p>Example: subdomain frontend automatically receives the
router subdomain apps.mycluster.com to have a full hostname
frontend.apps.mycluster.com.</p><p>If you have access to an OpenShift cluster you can test the above route manifest to see the results. Let&rsquo;s create a quick route-example.yaml file and use the <em>subdomain</em> property.
From the command line type the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ cat &lt;&lt;EOF &gt; /tmp/route-example.yaml
</span></span><span style=display:flex><span>apiVersion: route.openshift.io/v1
</span></span><span style=display:flex><span>kind: Route
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: hello-openshift
</span></span><span style=display:flex><span>  namespace: hello-openshift
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  subdomain: hello-openshift-hello-openshift 
</span></span><span style=display:flex><span>  port:
</span></span><span style=display:flex><span>    targetPort: 8080
</span></span><span style=display:flex><span>  to:
</span></span><span style=display:flex><span>    kind: Service
</span></span><span style=display:flex><span>    name: hello-openshift
</span></span><span style=display:flex><span>EOF
</span></span></code></pre></div><p>Now let&rsquo;s create a namespace where we will test create our <em>Route</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ oc create ns hello-openshift
</span></span><span style=display:flex><span>namespace/hello-openshift created
</span></span></code></pre></div><p>Now let&rsquo;s change our context to that namespace.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ oc project hello-openshift
</span></span><span style=display:flex><span>Now using project &#34;hello-openshift&#34; on server &#34;https://api.magic-mirror-2.blueprints.rhecoeng.com:6443&#34;.
</span></span></code></pre></div><p>Last but not least now let&rsquo;s apply that example route definition we just created.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ oc create -f /tmp/route-example.yaml 
</span></span><span style=display:flex><span>route.route.openshift.io/hello-openshift created
</span></span></code></pre></div><p>If we inspect what was applied to the OpenShift cluster you should be able to see the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>$ oc get route/hello-openshift -o yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>route.openshift.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Route</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>openshift.io/host.generated</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>creationTimestamp</span>: <span style=color:#e6db74>&#34;2022-09-02T21:55:58Z&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>hello-openshift</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>hello-openshift</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resourceVersion</span>: <span style=color:#e6db74>&#34;1349531&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>uid</span>: <span style=color:#ae81ff>c0cddbb2-271e-48fb-b7fd-bcd8c5075cdf</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>hello-openshift-hello-openshift.apps.magic-mirror-2.blueprints.rhecoeng.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>subdomain</span>: <span style=color:#ae81ff>hello-openshift-hello-openshift</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>hello-openshift</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>wildcardPolicy</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>conditions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>lastTransitionTime</span>: <span style=color:#e6db74>&#34;2022-09-02T21:55:58Z&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#34;True&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Admitted</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>host</span>: <span style=color:#ae81ff>hello-openshift-hello-openshift.apps.magic-mirror-2.blueprints.rhecoeng.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>routerCanonicalHostname</span>: <span style=color:#ae81ff>router-default.apps.magic-mirror-2.blueprints.rhecoeng.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>routerName</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>wildcardPolicy</span>: <span style=color:#ae81ff>None</span>
</span></span></code></pre></div><p>As you can see the <em>subdomain</em> property was replaced with the <em>host</em> property but it includes the ingress domain for the cluster. Why is this important? I can now apply this to any OpenShift cluster without worrying it&rsquo;s ingress domain since it will get appended automatically.</p><blockquote><p>There is currently a known issue when using the <em>subdomain</em> property in which the name given is not published with the correct template, instead of that they are published with the default &lsquo;${name}-${namespace}.subdomain.local&rsquo;. This has been fixed and it&rsquo;s available in OpenShift 4.11.</p></blockquote><h1 id=conclusion>Conclusion</h1><p>Using the <em>subdomain</em> property when defining route is super useful if you are deploying your application to different clusters and it will allow you to not have to hard code the ingress domain for every cluster.</p><p>If you have any questions or want to see what we are working on please feel free to visit our <a href=https://hybrid-cloud-patterns.io/>Hybrid Cloud Patterns</a> site. If you are excited or intrigued by what you see here we’d love to hear your thoughts and ideas! Try the patterns contained in our <a href=https://github.com/hybrid-cloud-patterns>Hybrid Cloud Patterns Repo</a>. We will review your pull requests to our pattern repositories.</p></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#what-is-a-route-in-openshift>What Is a route in OpenShift?</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#how-is-the-kind-route-used-in-openshift>How is the kind: Route used in OpenShift?</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#the-kind-route-spec-to-the-rescue>The kind: Route spec to the rescue</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#conclusion>Conclusion</a></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-new-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>